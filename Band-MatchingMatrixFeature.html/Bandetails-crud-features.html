<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #7c3aed;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --border-radius: 10px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --transition: all 0.3s ease;
            --band-blue: #102a43;
            --band-light-blue: #243b53;
            --scheduled-blue: #1e40af;
            --project-purple: #5b21b6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e3e8f0 100%);
            color: var(--dark);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border-left: 5px solid var(--primary);
        }

        .header h1 {
            color: var(--dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header h1 i {
            color: var(--primary);
        }

        .subtitle {
            color: var(--gray);
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        /* Controls Panel */
        .controls-panel {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-label {
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-input {
            padding: 10px 15px;
            border: 2px solid var(--gray-light);
            border-radius: 6px;
            font-size: 0.95rem;
            transition: var(--transition);
        }

        .control-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        select.control-input {
            background: white;
            cursor: pointer;
        }

        /* Matrix Container */
        .matrix-container {
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            overflow: auto;
            max-height: 700px;
            background: white;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 2000px;
        }

        .matrix-table th {
            background: var(--dark);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            min-width: 180px;
            border-right: 1px solid var(--gray);
        }

        .matrix-table th:first-child {
            position: sticky;
            left: 0;
            background: var(--dark);
            z-index: 20;
            min-width: 250px;
        }

        .matrix-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--gray-light);
            border-right: 1px solid var(--gray-light);
            background: white;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            transition: var(--transition);
        }

        .matrix-table td:first-child {
            position: sticky;
            left: 0;
            background: var(--light);
            font-weight: 500;
            z-index: 5;
            min-width: 250px;
        }

        .matrix-table tr:hover td {
            background: #f8fafc;
        }

        .matrix-table tr:hover td:first-child {
            background: #e2e8f0;
        }

        /* Cell Styles */
        .cell-input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid var(--gray-light);
            border-radius: 4px;
            font-size: 0.9rem;
            transition: var(--transition);
            background: white;
        }

        .cell-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
            background: #f8fafc;
        }

        /* Band Details Panel Styles */
        .band-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 50%;
            height: 100%;
            background: white;
            box-shadow: -5px 0 25px rgba(0,0,0,0.1);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .band-panel.active {
            transform: translateX(0);
        }

        .band-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .band-overlay.active {
            display: block;
        }

        .band-header {
            padding: 20px;
            background: var(--dark);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--gray-light);
        }

        .band-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .band-footer {
            padding: 15px 20px;
            background: var(--light);
            border-top: 1px solid var(--gray-light);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* Band Tables */
        .band-table-container {
            margin: 20px 0;
            overflow-x: auto;
        }

        .band-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .band-table th {
            background: var(--band-blue);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-right: 1px solid var(--gray);
        }

        .band-table tr.rc-band-group th {
            background: var(--band-blue);
            color: #fff;
            text-align: center;
        }

        .band-table tr.rc-band-sub th {
            background: var(--band-light-blue);
            color: #fff;
            text-align: left;
            font-weight: 600;
        }

        .band-table td {
            padding: 10px;
            border: 1px solid var(--gray-light);
            text-align: left;
        }

        .band-table tr:hover td {
            background: #f8fafc;
        }

        /* Band CRUD Controls */
        .band-actions {
            display: flex;
            gap: 8px;
            margin: 10px 0;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #0da271;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #6d28d9;
        }

        /* Editable Band Cells */
        .band-edit-input {
            width: 100%;
            padding: 6px;
            border: 1px solid var(--gray-light);
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .band-edit-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
        }

        /* Matrix Cell with Band Indicator */
        .cell-with-band {
            position: relative;
            cursor: pointer;
        }

        .cell-with-band:hover {
            background: #f0f9ff !important;
        }

        .band-indicator {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--secondary);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            cursor: pointer;
        }

        .cell-band-btn {
            background: transparent;
            border: none;
            color: var(--secondary);
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 0.8rem;
        }

        .cell-band-btn:hover {
            background: rgba(124, 58, 237, 0.1);
        }

        /* Search Bar */
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 15px 20px 15px 50px;
            border: 2px solid var(--gray-light);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        /* Matrix Stats */
        .matrix-stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            padding: 15px;
            background: var(--light);
            border-radius: 8px;
            font-size: 0.9rem;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 20px;
            background: white;
            border-radius: 6px;
            min-width: 100px;
            box-shadow: var(--shadow);
        }

        .stat-value {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--gray);
            text-align: center;
        }

        /* Service Type Cards */
        .service-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .service-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid var(--primary);
        }

        .service-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .service-card.dispatch {
            border-left-color: var(--success);
        }

        .service-card.dedicated {
            border-left-color: var(--danger);
        }

        .service-card.scheduled {
            border-left-color: var(--scheduled-blue);
        }

        .service-card.project {
            border-left-color: var(--project-purple);
        }

        .service-card.standby {
            border-left-color: var(--warning);
        }

        .service-card.rate-card {
            border-left-color: var(--info);
        }

        .service-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .service-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .dispatch .service-icon { background: var(--success); }
        .dedicated .service-icon { background: var(--danger); }
        .scheduled .service-icon { background: var(--scheduled-blue); }
        .project .service-icon { background: var(--project-purple); }
        .standby .service-icon { background: var(--warning); }
        .rate-card .service-icon { background: var(--info); }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: var(--success);
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            z-index: 2000;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
            max-width: 400px;
            display: none;
        }

        .notification.error { background: var(--danger); }
        .notification.warning { background: var(--warning); }
        .notification.info { background: var(--info); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .band-panel {
                width: 90%;
            }
            
            .controls-panel {
                grid-template-columns: 1fr;
            }
            
            .service-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-table"></i> Enhanced Matching Matrix with Band Management</h1>
            <p class="subtitle">8-Table Real-Time Auto-Population with Full Band CRUD Operations</p>
        </div>

        <!-- Search -->
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-input" id="searchInput" placeholder="Search fields, tables, or values...">
        </div>

        <!-- Service Type Cards -->
        <div class="service-cards">
            <div class="service-card dedicated" onclick="showBandDetails('dedicated')">
                <div class="service-header">
                    <div class="service-icon"><i class="fas fa-user-tie"></i></div>
                    <div>
                        <h3>Dedicated Services</h3>
                        <p>Monthly dedicated resource pricing</p>
                    </div>
                </div>
                <div class="band-preview">
                    <div><strong>Bands:</strong> 0-4</div>
                    <div><strong>Variants:</strong> With/Without Benefits</div>
                </div>
            </div>

            <div class="service-card scheduled" onclick="showBandDetails('scheduled')">
                <div class="service-header">
                    <div class="service-icon"><i class="fas fa-calendar-check"></i></div>
                    <div>
                        <h3>Scheduled Services</h3>
                        <p>Full day & half day visit pricing</p>
                    </div>
                </div>
                <div class="band-preview">
                    <div><strong>Full Day:</strong> Bands 0-2</div>
                    <div><strong>Half Day:</strong> Bands 0-2</div>
                </div>
            </div>

            <div class="service-card dispatch" onclick="showBandDetails('dispatch')">
                <div class="service-header">
                    <div class="service-icon"><i class="fas fa-truck-fast"></i></div>
                    <div>
                        <h3>Dispatch Services</h3>
                        <p>Incident & IMAC ticket pricing</p>
                    </div>
                </div>
                <div class="band-preview">
                    <div><strong>Incident:</strong> 4H, SBD, NBD, 2-3BD, Additional Hour</div>
                    <div><strong>IMAC:</strong> 2-4 Business Days</div>
                </div>
            </div>

            <div class="service-card project" onclick="showBandDetails('project')">
                <div class="service-header">
                    <div class="service-icon"><i class="fas fa-project-diagram"></i></div>
                    <div>
                        <h3>Project Work</h3>
                        <p>Short & long term project pricing</p>
                    </div>
                </div>
                <div class="band-preview">
                    <div><strong>Short Term:</strong> ≤3 months, Bands 0-4</div>
                    <div><strong>Long Term:</strong> >3 months, Bands 0-4</div>
                </div>
            </div>
        </div>

        <!-- Matrix Container -->
        <div class="matrix-container">
            <table class="matrix-table" id="matrixTable">
                <thead>
                    <tr id="matrixHeader"></tr>
                </thead>
                <tbody id="matrixBody"></tbody>
            </table>
        </div>

        <!-- Matrix Stats -->
        <div class="matrix-stats">
            <div class="stat-item">
                <div class="stat-value" id="totalColumns">0</div>
                <div class="stat-label">Total Fields</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="bandTables">4</div>
                <div class="stat-label">Band Tables</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="bandEntries">0</div>
                <div class="stat-label">Band Entries</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="modifiedCount">0</div>
                <div class="stat-label">Modified</div>
            </div>
        </div>
    </div>

    <!-- Band Details Panel -->
    <div class="band-overlay" id="bandOverlay" onclick="closeBandPanel()"></div>
    <div class="band-panel" id="bandPanel">
        <div class="band-header">
            <h2 id="bandPanelTitle">Band Details</h2>
            <button class="btn btn-danger" onclick="closeBandPanel()">
                <i class="fas fa-times"></i> Close
            </button>
        </div>
        <div class="band-content" id="bandContent">
            <!-- Dynamic content will be loaded here -->
        </div>
        <div class="band-footer" id="bandFooter">
            <!-- Dynamic footer buttons -->
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationMessage">Operation successful</span>
    </div>

    <script>
        // Global state
        const state = {
            currentServiceType: null,
            currentCustomer: 'hcl',
            bandData: {
                dedicated: {},
                scheduled: {},
                dispatch: {},
                project: {}
            },
            modifiedCount: 0
        };

        // Sample data structure for bands
        const bandStructures = {
            dedicated: {
                title: "Dedicated Services",
                icon: "fas fa-user-tie",
                color: "#ef4444",
                description: "Monthly dedicated resource pricing with 5 bands",
                structure: {
                    bands: ['Band 0', 'Band 1', 'Band 2', 'Band 3', 'Band 4'],
                    columns: ['With Benefits', 'Without Benefits', 'Difference'],
                    groups: [{
                        title: "Dedicated Services",
                        bands: ['Band 0', 'Band 1', 'Band 2', 'Band 3', 'Band 4']
                    }]
                },
                customers: ['hcl', 'fresenius', 'acme']
            },
            scheduled: {
                title: "Scheduled Services",
                icon: "fas fa-calendar-check",
                color: "#1e40af",
                description: "Full day & half day visit pricing",
                structure: {
                    groups: [{
                        title: "Full Day Visit (8hrs)",
                        bands: ['Band 0', 'Band 1', 'Band 2'],
                        columns: ['Price', 'Duration', 'Max Hours', 'Description']
                    }, {
                        title: "1/2 Day Visit (4hrs)",
                        bands: ['Band 0', 'Band 1', 'Band 2'],
                        columns: ['Price', 'Duration', 'Max Hours', 'Description']
                    }]
                },
                customers: ['hcl', 'fresenius', 'acme']
            },
            dispatch: {
                title: "Dispatch Services",
                icon: "fas fa-truck-fast",
                color: "#10b981",
                description: "On-demand incident & IMAC pricing",
                structure: {
                    groups: [{
                        title: "Dispatch Ticket (Incident)",
                        bands: ['4 hour', 'SBD', 'NBD', '2 BD', '3 BD', 'Additional Hour'],
                        columns: ['Price', 'SLA', 'Description']
                    }, {
                        title: "Dispatch Ticket (IMAC)",
                        bands: ['2 BD', '3 BD', '4 BD'],
                        columns: ['Price', 'Timeframe', 'Scope']
                    }]
                },
                customers: ['hcl', 'fresenius', 'acme']
            },
            project: {
                title: "Project Work",
                icon: "fas fa-project-diagram",
                color: "#5b21b6",
                description: "Short & long term project pricing",
                structure: {
                    groups: [{
                        title: "Short Term (Up to 3 months)",
                        bands: ['Band 0', 'Band 1', 'Band 2', 'Band 3', 'Band 4'],
                        columns: ['Price', 'Duration', 'Min Term', 'Max Term']
                    }, {
                        title: "Long Term (more than 3 months)",
                        bands: ['Band 0', 'Band 1', 'Band 2', 'Band 3', 'Band 4'],
                        columns: ['Price', 'Duration', 'Min Term', 'Max Term']
                    }]
                },
                customers: ['hcl', 'fresenius', 'acme']
            }
        };

        // Initialize band data with sample values
        function initializeBandData() {
            const customers = ['hcl', 'fresenius', 'acme'];
            
            customers.forEach(customer => {
                // Dedicated bands
                state.bandData.dedicated[customer] = {
                    'Band 0': ['$26,000', '$23,000', '$3,000'],
                    'Band 1': ['$28,000', '$25,000', '$3,000'],
                    'Band 2': ['$30,000', '$27,000', '$3,000'],
                    'Band 3': ['$32,000', '$29,000', '$3,000'],
                    'Band 4': ['$34,000', '$31,000', '$3,000']
                };

                // Scheduled bands
                state.bandData.scheduled[customer] = {
                    'Full Day Visit (8hrs)': {
                        'Band 0': ['$300', '8 hours', '8', 'Full Day'],
                        'Band 1': ['$320', '8 hours', '8', 'Full Day'],
                        'Band 2': ['$350', '8 hours', '8', 'Full Day']
                    },
                    '1/2 Day Visit (4hrs)': {
                        'Band 0': ['$150', '4 hours', '4', 'Half Day'],
                        'Band 1': ['$160', '4 hours', '4', 'Half Day'],
                        'Band 2': ['$175', '4 hours', '4', 'Half Day']
                    }
                };

                // Dispatch bands
                state.bandData.dispatch[customer] = {
                    'Dispatch Ticket (Incident)': {
                        '4 hour': ['$350', '4 hours', 'Immediate response'],
                        'SBD': ['$450', 'Same Day', 'Business hours'],
                        'NBD': ['$550', 'Next Day', 'Business hours'],
                        '2 BD': ['$650', '2 Days', 'Business days'],
                        '3 BD': ['$750', '3 Days', 'Business days'],
                        'Additional Hour': ['$120/hr', 'Hourly', 'Extra time']
                    },
                    'Dispatch Ticket (IMAC)': {
                        '2 BD': ['$800', '2 Days', 'IMAC Work'],
                        '3 BD': ['$950', '3 Days', 'IMAC Work'],
                        '4 BD': ['$1,100', '4 Days', 'IMAC Work']
                    }
                };

                // Project bands
                state.bandData.project[customer] = {
                    'Short Term (Up to 3 months)': {
                        'Band 0': ['$5,000', '<3 months', '1 month', '3 months'],
                        'Band 1': ['$5,500', '<3 months', '1 month', '3 months'],
                        'Band 2': ['$6,000', '<3 months', '1 month', '3 months'],
                        'Band 3': ['$6,500', '<3 months', '1 month', '3 months'],
                        'Band 4': ['$7,000', '<3 months', '1 month', '3 months']
                    },
                    'Long Term (more than 3 months)': {
                        'Band 0': ['$4,500', '>3 months', '4 months', '12 months'],
                        'Band 1': ['$5,000', '>3 months', '4 months', '12 months'],
                        'Band 2': ['$5,500', '>3 months', '4 months', '12 months'],
                        'Band 3': ['$6,000', '>3 months', '4 months', '12 months'],
                        'Band 4': ['$6,500', '>3 months', '4 months', '12 months']
                    }
                };
            });
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeBandData();
            renderMatrix();
            updateStats();
            
            // Set up event listeners
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            
            // Close panel with ESC key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') closeBandPanel();
            });
        });

        // Render matrix
        function renderMatrix() {
            const header = document.getElementById('matrixHeader');
            const body = document.getElementById('matrixBody');
            
            // Clear existing content
            header.innerHTML = '';
            body.innerHTML = '';
            
            // Create headers
            const serviceTypes = ['dedicated', 'scheduled', 'dispatch', 'project'];
            const tableHeaders = ['Field Name'];
            
            serviceTypes.forEach(type => {
                const structure = bandStructures[type];
                tableHeaders.push(`
                    <div class="service-header">
                        <i class="${structure.icon}"></i>
                        <div>
                            <div>${structure.title}</div>
                            <small>${structure.description}</small>
                        </div>
                    </div>
                `);
            });
            
            // Add headers to table
            tableHeaders.forEach((headerHtml, index) => {
                const th = document.createElement('th');
                th.innerHTML = index === 0 ? '<i class="fas fa-columns"></i> Field Name' : headerHtml;
                header.appendChild(th);
            });
            
            // Create sample fields that would have band data
            const bandFields = [
                { name: 'Monthly rate', type: 'dedicated', description: 'Monthly dedicated resource rate' },
                { name: 'Band', type: 'dedicated', description: 'Band level for dedicated resources' },
                { name: 'Variant', type: 'dedicated', description: 'With or without benefits' },
                { name: 'Full Day Rate', type: 'scheduled', description: 'Full day visit rate' },
                { name: 'Half Day Rate', type: 'scheduled', description: 'Half day visit rate' },
                { name: 'Dispatch Rate', type: 'dispatch', description: 'Dispatch ticket rate' },
                { name: 'SLA', type: 'dispatch', description: 'Service Level Agreement' },
                { name: 'Project Rate', type: 'project', description: 'Project engagement rate' },
                { name: 'Project Duration', type: 'project', description: 'Project duration category' }
            ];
            
            // Add rows for each field
            bandFields.forEach(field => {
                const row = document.createElement('tr');
                row.setAttribute('data-field', field.name);
                row.setAttribute('data-type', field.type);
                
                // Field name cell
                const nameCell = document.createElement('td');
                nameCell.innerHTML = `
                    <strong>${field.name}</strong>
                    <div class="field-description">${field.description}</div>
                    <small>Band Details Available</small>
                `;
                row.appendChild(nameCell);
                
                // Service type cells
                serviceTypes.forEach(serviceType => {
                    const cell = document.createElement('td');
                    cell.className = 'cell-with-band';
                    
                    if (field.type === serviceType) {
                        const bandData = getBandDataForField(field.name, serviceType);
                        cell.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div class="band-value">${bandData.value || '—'}</div>
                                    <small class="band-info">${bandData.info || 'Click to edit band details'}</small>
                                </div>
                                <button class="cell-band-btn" onclick="showBandDetails('${serviceType}', '${field.name}')">
                                    <i class="fas fa-layer-group"></i> Edit Bands
                                </button>
                            </div>
                            <div class="band-indicator" onclick="showBandDetails('${serviceType}', '${field.name}')">
                                <i class="fas fa-edit"></i>
                            </div>
                        `;
                    } else {
                        cell.innerHTML = '<div class="text-muted">N/A</div>';
                    }
                    
                    row.appendChild(cell);
                });
                
                body.appendChild(row);
            });
        }

        // Get band data for a specific field
        function getBandDataForField(fieldName, serviceType) {
            const customer = state.currentCustomer;
            const data = state.bandData[serviceType][customer];
            
            switch(fieldName) {
                case 'Monthly rate':
                    return {
                        value: data?.['Band 2']?.[0] || '$30,000',
                        info: 'Band 2 - With Benefits'
                    };
                case 'Full Day Rate':
                    return {
                        value: data?.['Full Day Visit (8hrs)']?.['Band 2']?.[0] || '$350',
                        info: 'Band 2 - Full Day'
                    };
                case 'Dispatch Rate':
                    return {
                        value: data?.['Dispatch Ticket (Incident)']?.['4 hour']?.[0] || '$350',
                        info: '4H - Incident'
                    };
                case 'Project Rate':
                    return {
                        value: data?.['Short Term (Up to 3 months)']?.['Band 2']?.[0] || '$6,000',
                        info: 'Band 2 - Short Term'
                    };
                default:
                    return { value: '—', info: 'Click to configure' };
            }
        }

        // Show band details panel
        function showBandDetails(serviceType, fieldName = null) {
            state.currentServiceType = serviceType;
            const panel = document.getElementById('bandPanel');
            const overlay = document.getElementById('bandOverlay');
            const title = document.getElementById('bandPanelTitle');
            const content = document.getElementById('bandContent');
            const footer = document.getElementById('bandFooter');
            
            const structure = bandStructures[serviceType];
            title.textContent = `${structure.title} Band Management`;
            
            // Load appropriate content based on service type
            if (serviceType === 'dedicated') {
                content.innerHTML = renderDedicatedBands();
            } else if (serviceType === 'scheduled') {
                content.innerHTML = renderScheduledBands();
            } else if (serviceType === 'dispatch') {
                content.innerHTML = renderDispatchBands();
            } else if (serviceType === 'project') {
                content.innerHTML = renderProjectBands();
            }
            
            // Set up footer buttons
            footer.innerHTML = `
                <button class="btn btn-secondary" onclick="addNewBand('${serviceType}')">
                    <i class="fas fa-plus"></i> Add Band
                </button>
                <button class="btn btn-success" onclick="saveBandChanges('${serviceType}')">
                    <i class="fas fa-save"></i> Save Changes
                </button>
                <button class="btn btn-primary" onclick="exportBandData('${serviceType}')">
                    <i class="fas fa-download"></i> Export
                </button>
            `;
            
            panel.classList.add('active');
            overlay.classList.add('active');
        }

        // Close band panel
        function closeBandPanel() {
            document.getElementById('bandPanel').classList.remove('active');
            document.getElementById('bandOverlay').classList.remove('active');
            state.currentServiceType = null;
        }

        // Render dedicated bands
        function renderDedicatedBands() {
            const customer = state.currentCustomer;
            const data = state.bandData.dedicated[customer] || {};
            const structure = bandStructures.dedicated;
            
            let html = `
                <div class="band-section">
                    <h3><i class="${structure.icon}"></i> ${structure.title}</h3>
                    <p>${structure.description}</p>
                    
                    <div class="customer-selector" style="margin: 15px 0;">
                        <label>Customer:</label>
                        <select class="control-input" onchange="changeCustomer(this.value)" style="margin-left: 10px;">
                            ${bandStructures.dedicated.customers.map(cust => `
                                <option value="${cust}" ${cust === customer ? 'selected' : ''}>
                                    ${cust.toUpperCase()}
                                </option>
                            `).join('')}
                        </select>
                    </div>
                    
                    <div class="band-actions">
                        <button class="btn btn-warning" onclick="resetToDefault('dedicated')">
                            <i class="fas fa-undo"></i> Reset to Default
                        </button>
                    </div>
                    
                    <div class="band-table-container">
                        <table class="band-table">
                            <thead>
                                <tr class="rc-band-group">
                                    <th colspan="${structure.structure.columns.length + 1}">${structure.structure.groups[0].title}</th>
                                </tr>
                                <tr class="rc-band-sub">
                                    <th>Band</th>
                                    ${structure.structure.columns.map(col => `<th>${col}</th>`).join('')}
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>`;
            
            structure.structure.bands.forEach(band => {
                const bandData = data[band] || ['', '', ''];
                html += `
                    <tr data-band="${band}">
                        <td><strong>${band}</strong></td>
                        ${structure.structure.columns.map((col, index) => `
                            <td>
                                <input type="text" 
                                       class="band-edit-input" 
                                       data-band="${band}" 
                                       data-column="${index}"
                                       value="${bandData[index] || ''}"
                                       onchange="updateBandValue('dedicated', '${band}', ${index}, this.value)">
                            </td>
                        `).join('')}
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="deleteBand('dedicated', '${band}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="band-notes" style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 8px;">
                        <h4><i class="fas fa-info-circle"></i> Notes</h4>
                        <ul>
                            <li>All prices are in USD unless specified otherwise</li>
                            <li>With Benefits includes healthcare, insurance, etc.</li>
                            <li>Without Benefits is base rate only</li>
                            <li>Difference = With Benefits - Without Benefits</li>
                        </ul>
                    </div>
                </div>
            `;
            
            return html;
        }

        // Render scheduled bands
        function renderScheduledBands() {
            const customer = state.currentCustomer;
            const data = state.bandData.scheduled[customer] || {};
            const structure = bandStructures.scheduled;
            
            let html = `
                <div class="band-section">
                    <h3><i class="${structure.icon}"></i> ${structure.title}</h3>
                    <p>${structure.description}</p>
                    
                    <div class="customer-selector" style="margin: 15px 0;">
                        <label>Customer:</label>
                        <select class="control-input" onchange="changeCustomer(this.value)" style="margin-left: 10px;">
                            ${bandStructures.scheduled.customers.map(cust => `
                                <option value="${cust}" ${cust === customer ? 'selected' : ''}>
                                    ${cust.toUpperCase()}
                                </option>
                            `).join('')}
                        </select>
                    </div>`;
            
            structure.structure.groups.forEach(group => {
                const groupData = data[group.title] || {};
                
                html += `
                    <div class="band-group" style="margin: 20px 0;">
                        <h4>${group.title}</h4>
                        <div class="band-table-container">
                            <table class="band-table">
                                <thead>
                                    <tr class="rc-band-sub">
                                        <th>Band</th>
                                        ${group.columns.map(col => `<th>${col}</th>`).join('')}
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>`;
                
                group.bands.forEach(band => {
                    const bandData = groupData[band] || Array(group.columns.length).fill('');
                    html += `
                        <tr data-band="${band}" data-group="${group.title}">
                            <td><strong>${band}</strong></td>
                            ${group.columns.map((col, index) => `
                                <td>
                                    <input type="text" 
                                           class="band-edit-input" 
                                           data-band="${band}" 
                                           data-group="${group.title}"
                                           data-column="${index}"
                                           value="${bandData[index] || ''}"
                                           onchange="updateScheduledBand('${group.title}', '${band}', ${index}, this.value)">
                                </td>
                            `).join('')}
                            <td>
                                <button class="btn btn-danger btn-sm" onclick="deleteScheduledBand('${group.title}', '${band}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            });
            
            html += `
                    <div class="band-notes" style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 8px;">
                        <h4><i class="fas fa-info-circle"></i> Notes</h4>
                        <ul>
                            <li>Full Day Visit = 8 hours maximum</li>
                            <li>1/2 Day Visit = 4 hours maximum</li>
                            <li>Additional hours billed at 1.5x hourly rate</li>
                            <li>Weekend rates are 2x standard rates</li>
                        </ul>
                    </div>
                </div>
            `;
            
            return html;
        }

        // Render dispatch bands
        function renderDispatchBands() {
            const customer = state.currentCustomer;
            const data = state.bandData.dispatch[customer] || {};
            const structure = bandStructures.dispatch;
            
            let html = `
                <div class="band-section">
                    <h3><i class="${structure.icon}"></i> ${structure.title}</h3>
                    <p>${structure.description}</p>
                    
                    <div class="customer-selector" style="margin: 15px 0;">
                        <label>Customer:</label>
                        <select class="control-input" onchange="changeCustomer(this.value)" style="margin-left: 10px;">
                            ${bandStructures.dispatch.customers.map(cust => `
                                <option value="${cust}" ${cust === customer ? 'selected' : ''}>
                                    ${cust.toUpperCase()}
                                </option>
                            `).join('')}
                        </select>
                    </div>`;
            
            structure.structure.groups.forEach(group => {
                const groupData = data[group.title] || {};
                
                html += `
                    <div class="band-group" style="margin: 20px 0;">
                        <h4>${group.title}</h4>
                        <div class="band-table-container">
                            <table class="band-table">
                                <thead>
                                    <tr class="rc-band-sub">
                                        <th>Service Type</th>
                                        ${group.columns.map(col => `<th>${col}</th>`).join('')}
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>`;
                
                group.bands.forEach(band => {
                    const bandData = groupData[band] || Array(group.columns.length).fill('');
                    html += `
                        <tr data-band="${band}" data-group="${group.title}">
                            <td><strong>${band}</strong></td>
                            ${group.columns.map((col, index) => `
                                <td>
                                    <input type="text" 
                                           class="band-edit-input" 
                                           data-band="${band}" 
                                           data-group="${group.title}"
                                           data-column="${index}"
                                           value="${bandData[index] || ''}"
                                           onchange="updateDispatchBand('${group.title}', '${band}', ${index}, this.value)">
                                </td>
                            `).join('')}
                            <td>
                                <button class="btn btn-danger btn-sm" onclick="deleteDispatchBand('${group.title}', '${band}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            });
            
            html += `
                    <div class="band-notes" style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 8px;">
                        <h4><i class="fas fa-info-circle"></i> Notes</h4>
                        <ul>
                            <li>4H = 4 hour response time guarantee</li>
                            <li>SBD = Same Business Day</li>
                            <li>NBD = Next Business Day</li>
                            <li>Additional Hour rate applies after first 4 hours</li>
                            <li>IMAC = Install, Move, Add, Change</li>
                        </ul>
                    </div>
                </div>
            `;
            
            return html;
        }

        // Render project bands
        function renderProjectBands() {
            const customer = state.currentCustomer;
            const data = state.bandData.project[customer] || {};
            const structure = bandStructures.project;
            
            let html = `
                <div class="band-section">
                    <h3><i class="${structure.icon}"></i> ${structure.title}</h3>
                    <p>${structure.description}</p>
                    
                    <div class="customer-selector" style="margin: 15px 0;">
                        <label>Customer:</label>
                        <select class="control-input" onchange="changeCustomer(this.value)" style="margin-left: 10px;">
                            ${bandStructures.project.customers.map(cust => `
                                <option value="${cust}" ${cust === customer ? 'selected' : ''}>
                                    ${cust.toUpperCase()}
                                </option>
                            `).join('')}
                        </select>
                    </div>`;
            
            structure.structure.groups.forEach(group => {
                const groupData = data[group.title] || {};
                
                html += `
                    <div class="band-group" style="margin: 20px 0;">
                        <h4>${group.title}</h4>
                        <div class="band-table-container">
                            <table class="band-table">
                                <thead>
                                    <tr class="rc-band-sub">
                                        <th>Band</th>
                                        ${group.columns.map(col => `<th>${col}</th>`).join('')}
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>`;
                
                group.bands.forEach(band => {
                    const bandData = groupData[band] || Array(group.columns.length).fill('');
                    html += `
                        <tr data-band="${band}" data-group="${group.title}">
                            <td><strong>${band}</strong></td>
                            ${group.columns.map((col, index) => `
                                <td>
                                    <input type="text" 
                                           class="band-edit-input" 
                                           data-band="${band}" 
                                           data-group="${group.title}"
                                           data-column="${index}"
                                           value="${bandData[index] || ''}"
                                           onchange="updateProjectBand('${group.title}', '${band}', ${index}, this.value)">
                                </td>
                            `).join('')}
                            <td>
                                <button class="btn btn-danger btn-sm" onclick="deleteProjectBand('${group.title}', '${band}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            });
            
            html += `
                    <div class="band-notes" style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 8px;">
                        <h4><i class="fas fa-info-circle"></i> Notes</h4>
                        <ul>
                            <li>Short Term = Up to 3 months engagement</li>
                            <li>Long Term = More than 3 months engagement</li>
                            <li>Monthly rates are for full-time equivalent</li>
                            <li>Minimum engagement: 1 month for short term, 4 months for long term</li>
                        </ul>
                    </div>
                </div>
            `;
            
            return html;
        }

        // Update band value (generic)
        function updateBandValue(serviceType, band, columnIndex, value) {
            if (!state.bandData[serviceType][state.currentCustomer]) {
                state.bandData[serviceType][state.currentCustomer] = {};
            }
            
            if (!state.bandData[serviceType][state.currentCustomer][band]) {
                state.bandData[serviceType][state.currentCustomer][band] = ['', '', ''];
            }
            
            state.bandData[serviceType][state.currentCustomer][band][columnIndex] = value;
            state.modifiedCount++;
            updateStats();
            
            // For dedicated bands, calculate difference
            if (serviceType === 'dedicated' && columnIndex < 2) {
                calculateDedicatedDifference(band);
            }
        }

        // Update scheduled band
        function updateScheduledBand(group, band, columnIndex, value) {
            if (!state.bandData.scheduled[state.currentCustomer]) {
                state.bandData.scheduled[state.currentCustomer] = {};
            }
            
            if (!state.bandData.scheduled[state.currentCustomer][group]) {
                state.bandData.scheduled[state.currentCustomer][group] = {};
            }
            
            if (!state.bandData.scheduled[state.currentCustomer][group][band]) {
                const columns = bandStructures.scheduled.structure.groups.find(g => g.title === group).columns;
                state.bandData.scheduled[state.currentCustomer][group][band] = Array(columns.length).fill('');
            }
            
            state.bandData.scheduled[state.currentCustomer][group][band][columnIndex] = value;
            state.modifiedCount++;
            updateStats();
        }

        // Update dispatch band
        function updateDispatchBand(group, band, columnIndex, value) {
            if (!state.bandData.dispatch[state.currentCustomer]) {
                state.bandData.dispatch[state.currentCustomer] = {};
            }
            
            if (!state.bandData.dispatch[state.currentCustomer][group]) {
                state.bandData.dispatch[state.currentCustomer][group] = {};
            }
            
            if (!state.bandData.dispatch[state.currentCustomer][group][band]) {
                const columns = bandStructures.dispatch.structure.groups.find(g => g.title === group).columns;
                state.bandData.dispatch[state.currentCustomer][group][band] = Array(columns.length).fill('');
            }
            
            state.bandData.dispatch[state.currentCustomer][group][band][columnIndex] = value;
            state.modifiedCount++;
            updateStats();
        }

        // Update project band
        function updateProjectBand(group, band, columnIndex, value) {
            if (!state.bandData.project[state.currentCustomer]) {
                state.bandData.project[state.currentCustomer] = {};
            }
            
            if (!state.bandData.project[state.currentCustomer][group]) {
                state.bandData.project[state.currentCustomer][group] = {};
            }
            
            if (!state.bandData.project[state.currentCustomer][group][band]) {
                const columns = bandStructures.project.structure.groups.find(g => g.title === group).columns;
                state.bandData.project[state.currentCustomer][group][band] = Array(columns.length).fill('');
            }
            
            state.bandData.project[state.currentCustomer][group][band][columnIndex] = value;
            state.modifiedCount++;
            updateStats();
        }

        // Calculate difference for dedicated bands
        function calculateDedicatedDifference(band) {
            const data = state.bandData.dedicated[state.currentCustomer][band];
            if (data && data[0] && data[1]) {
                const withBenefits = parseFloat(data[0].replace(/[^0-9.-]+/g, ""));
                const withoutBenefits = parseFloat(data[1].replace(/[^0-9.-]+/g, ""));
                
                if (!isNaN(withBenefits) && !isNaN(withoutBenefits)) {
                    const difference = withBenefits - withoutBenefits;
                    data[2] = `$${difference.toLocaleString()}`;
                    
                    // Update the input field
                    const input = document.querySelector(`input[data-band="${band}"][data-column="2"]`);
                    if (input) {
                        input.value = data[2];
                    }
                }
            }
        }

        // Add new band
        function addNewBand(serviceType) {
            if (serviceType === 'dedicated') {
                addDedicatedBand();
            } else if (serviceType === 'scheduled') {
                addScheduledBand();
            } else if (serviceType === 'dispatch') {
                addDispatchBand();
            } else if (serviceType === 'project') {
                addProjectBand();
            }
        }

        // Add new dedicated band
        function addDedicatedBand() {
            const bands = bandStructures.dedicated.structure.bands;
            const lastBand = bands[bands.length - 1];
            const newBandNumber = parseInt(lastBand.replace('Band ', '')) + 1;
            const newBand = `Band ${newBandNumber}`;
            
            // Add to structure
            bandStructures.dedicated.structure.bands.push(newBand);
            
            // Add to data
            if (!state.bandData.dedicated[state.currentCustomer]) {
                state.bandData.dedicated[state.currentCustomer] = {};
            }
            
            state.bandData.dedicated[state.currentCustomer][newBand] = ['', '', ''];
            
            // Refresh display
            showBandDetails('dedicated');
            showNotification(`Added new band: ${newBand}`, 'success');
        }

        // Add new scheduled band
        function addScheduledBand() {
            const groupTitle = prompt("Enter group (Full Day Visit (8hrs) or 1/2 Day Visit (4hrs)):");
            if (!groupTitle) return;
            
            const bandName = prompt("Enter band name (e.g., Band 3):");
            if (!bandName) return;
            
            // Find group
            const group = bandStructures.scheduled.structure.groups.find(g => g.title === groupTitle);
            if (!group) {
                showNotification('Invalid group', 'error');
                return;
            }
            
            // Add band to group
            if (!group.bands.includes(bandName)) {
                group.bands.push(bandName);
                
                // Initialize data
                if (!state.bandData.scheduled[state.currentCustomer][groupTitle]) {
                    state.bandData.scheduled[state.currentCustomer][groupTitle] = {};
                }
                
                state.bandData.scheduled[state.currentCustomer][groupTitle][bandName] = Array(group.columns.length).fill('');
                
                // Refresh display
                showBandDetails('scheduled');
                showNotification(`Added ${bandName} to ${groupTitle}`, 'success');
            }
        }

        // Delete band
        function deleteBand(serviceType, band) {
            if (confirm(`Are you sure you want to delete ${band}?`)) {
                if (state.bandData[serviceType][state.currentCustomer]) {
                    delete state.bandData[serviceType][state.currentCustomer][band];
                    
                    // Remove from structure if it's a dedicated band
                    if (serviceType === 'dedicated') {
                        const index = bandStructures.dedicated.structure.bands.indexOf(band);
                        if (index > -1) {
                            bandStructures.dedicated.structure.bands.splice(index, 1);
                        }
                    }
                    
                    // Refresh display
                    showBandDetails(serviceType);
                    showNotification(`Deleted ${band}`, 'success');
                }
            }
        }

        // Delete scheduled band
        function deleteScheduledBand(group, band) {
            if (confirm(`Are you sure you want to delete ${band} from ${group}?`)) {
                if (state.bandData.scheduled[state.currentCustomer][group]) {
                    delete state.bandData.scheduled[state.currentCustomer][group][band];
                    
                    // Remove from structure
                    const structureGroup = bandStructures.scheduled.structure.groups.find(g => g.title === group);
                    if (structureGroup) {
                        const index = structureGroup.bands.indexOf(band);
                        if (index > -1) {
                            structureGroup.bands.splice(index, 1);
                        }
                    }
                    
                    // Refresh display
                    showBandDetails('scheduled');
                    showNotification(`Deleted ${band} from ${group}`, 'success');
                }
            }
        }

        // Delete dispatch band
        function deleteDispatchBand(group, band) {
            if (confirm(`Are you sure you want to delete ${band} from ${group}?`)) {
                if (state.bandData.dispatch[state.currentCustomer][group]) {
                    delete state.bandData.dispatch[state.currentCustomer][group][band];
                    
                    // Remove from structure
                    const structureGroup = bandStructures.dispatch.structure.groups.find(g => g.title === group);
                    if (structureGroup) {
                        const index = structureGroup.bands.indexOf(band);
                        if (index > -1) {
                            structureGroup.bands.splice(index, 1);
                        }
                    }
                    
                    // Refresh display
                    showBandDetails('dispatch');
                    showNotification(`Deleted ${band} from ${group}`, 'success');
                }
            }
        }

        // Delete project band
        function deleteProjectBand(group, band) {
            if (confirm(`Are you sure you want to delete ${band} from ${group}?`)) {
                if (state.bandData.project[state.currentCustomer][group]) {
                    delete state.bandData.project[state.currentCustomer][group][band];
                    
                    // Remove from structure
                    const structureGroup = bandStructures.project.structure.groups.find(g => g.title === group);
                    if (structureGroup) {
                        const index = structureGroup.bands.indexOf(band);
                        if (index > -1) {
                            structureGroup.bands.splice(index, 1);
                        }
                    }
                    
                    // Refresh display
                    showBandDetails('project');
                    showNotification(`Deleted ${band} from ${group}`, 'success');
                }
            }
        }

        // Save band changes
        function saveBandChanges(serviceType) {
            // In a real application, this would save to a database
            showNotification(`${bandStructures[serviceType].title} band data saved successfully`, 'success');
            state.modifiedCount = 0;
            updateStats();
        }

        // Export band data
        function exportBandData(serviceType) {
            const data = state.bandData[serviceType][state.currentCustomer];
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${serviceType}_bands_${state.currentCustomer}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(`Exported ${serviceType} band data`, 'success');
        }

        // Change customer
        function changeCustomer(customer) {
            state.currentCustomer = customer;
            
            // Refresh current panel if open
            if (state.currentServiceType) {
                showBandDetails(state.currentServiceType);
            }
            
            // Update matrix display
            renderMatrix();
            updateStats();
            
            showNotification(`Switched to ${customer.toUpperCase()}`, 'info');
        }

        // Reset to default values
        function resetToDefault(serviceType) {
            if (confirm('Are you sure you want to reset all values to default? This cannot be undone.')) {
                initializeBandData();
                showBandDetails(serviceType);
                showNotification('Reset to default values', 'success');
            }
        }

        // Handle search
        function handleSearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#matrixBody tr');
            
            rows.forEach(row => {
                const fieldName = row.getAttribute('data-field').toLowerCase();
                const cells = row.querySelectorAll('td');
                const rowText = Array.from(cells).map(cell => cell.textContent.toLowerCase()).join(' ');
                
                if (fieldName.includes(searchTerm) || rowText.includes(searchTerm)) {
                    row.style.display = '';
                    cells.forEach(cell => {
                        cell.style.backgroundColor = searchTerm ? '#f0f9ff' : '';
                    });
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Update statistics
        function updateStats() {
            let bandEntries = 0;
            Object.values(state.bandData).forEach(serviceData => {
                const customerData = serviceData[state.currentCustomer] || {};
                Object.values(customerData).forEach(bands => {
                    if (Array.isArray(bands)) {
                        bandEntries += bands.filter(val => val).length;
                    } else {
                        Object.values(bands).forEach(bandData => {
                            bandEntries += bandData.filter(val => val).length;
                        });
                    }
                });
            });
            
            document.getElementById('bandEntries').textContent = bandEntries;
            document.getElementById('modifiedCount').textContent = state.modifiedCount;
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const icon = notification.querySelector('i');
            const messageSpan = document.getElementById('notificationMessage');
            
            // Update content
            messageSpan.textContent = message;
            notification.className = `notification ${type}`;
            
            // Update icon based on type
            switch(type) {
                case 'error':
                    icon.className = 'fas fa-exclamation-circle';
                    break;
                case 'warning':
                    icon.className = 'fas fa-exclamation-triangle';
                    break;
                case 'info':
                    icon.className = 'fas fa-info-circle';
                    break;
                default:
                    icon.className = 'fas fa-check-circle';
            }
            
            // Show notification
            notification.style.display = 'flex';
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    notification.style.display = 'none';
                    notification.style.animation = '';
                }, 300);
            }, 3000);
        }

        // Add CSS for field description
        const style = document.createElement('style');
        style.textContent = `
            .field-description {
                font-size: 0.8rem;
                color: var(--gray);
                margin-top: 5px;
            }
            .band-value {
                font-weight: 600;
                color: var(--dark);
            }
            .band-info {
                font-size: 0.8rem;
                color: var(--gray);
            }
            .text-muted {
                color: var(--gray);
                font-style: italic;
            }
            .btn-sm {
                padding: 4px 8px;
                font-size: 0.8rem;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>